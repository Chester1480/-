<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <title></title>
    <link rel="stylesheet" href="https://scampus.yunlin.gov.tw/yunlin_line/css/styles.css" />
  </head>
  <body>
    <div class="outer" id="Map">
      <div class="inner map active">
        <p class="title text textL">盈碩國民小學</p>
        <div class="mapBox">
          <div id="mymap" style="width: 100%; height: 250px;"></div>
        </div>
        <div class="tabBox">
          <div class="tabTitle">
            <p class="text textL active" data-tab="tabInner1">販賣機</p>
            <p class="text textL" data-tab="tabInner2">智能回收機</p>
          </div>
          <div class="tabInner tabInner1 active">
            <div class="machine">
              <p class="text textS textGray">販賣機A</p>
              <p class="text textS textDark">XX樓 地下1F</p>
            </div>
            <div class="machine">
              <p class="text textS textGray">販賣機B</p>
              <p class="text textS textDark">XX樓 2F 樓梯口</p>
            </div>
            <div class="machine">
              <p class="text textS textGray">販賣機C</p>
              <p class="text textS textDark">XX樓 3F 樓梯口</p>
            </div>
            <div class="machine">
              <p class="text textS textGray">販賣機D</p>
              <p class="text textS textDark">XX樓 地下1F 餐廳</p>
            </div>
            <div class="machine">
              <p class="text textS textGray">販賣機E</p>
              <p class="text textS textDark">XX樓 地下1F</p>
            </div>
          </div>
          <div class="tabInner tabInner2">
            <div class="machine">
              <p class="text textS textGray">智能回收機A</p>
              <p class="text textS textDark">XX樓 地下1F</p>
            </div>
            <div class="machine">
              <p class="text textS textGray">智能回收機B</p>
              <p class="text textS textDark">XX樓 2F 樓梯口</p>
            </div>
            <div class="machine">
              <p class="text textS textGray">智能回收機C</p>
              <p class="text textS textDark">XX樓 3F 樓梯口</p>
            </div>
            <div class="machine">
              <p class="text textS textGray">智能回收機D</p>
              <p class="text textS textDark">XX樓 地下1F 餐廳</p>
            </div>
            <div class="machine">
              <p class="text textS textGray">智能回收機E</p>
              <p class="text textS textDark">XX樓 地下1F</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="https://scampus.yunlin.gov.tw/yunlin_line/js/jquery-1.11.3.min.js"></script>
  <script src="https://scampus.yunlin.gov.tw/yunlin_line/js/vue.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap"
    async defer></script>
  <!--上面的key要帶入google api的key-->
  <script src="https://scampus.yunlin.gov.tw/yunlin_line/js/script.js"></script>
  <script src="https://scampus.yunlin.gov.tw/yunlin_line/js/sdk.js"></script>


  <script>
    var map;
    var marker = [];
    var infowindow = [];
    function initMap() {
      map = new google.maps.Map(document.getElementById('mymap'), {
        center: {lat: 25.033977, lng: 121.563998},
        zoom: 18
      });
      var data = [
        {
          position : { lat: 25.033977, lng: 121.563998 },
          map:map,
          title:'盈碩國民小學',
          Clickable: true
        },
        {
          position : { lat: 25.033885, lng: 121.564047 },
          map:map,
          title:'販賣機A',
          Clickable: true
        }
      ];
      var data2 = [
        {
          position : { lat: 25.033977, lng: 121.563998 },
          content:'盈碩國民小學'
        },
        {
          position : { lat: 25.033885, lng: 121.564047 },
          content:'販賣機A'
        }
      ];
      for (var i= 0; data.length >i ; i++) {
        let idx = i;
        marker.push(new google.maps.Marker(data[i]));
        infowindow.push(new google.maps.InfoWindow(data2[i]));
        marker[i].addListener('click',function(){
          infowindow[idx].open(map, marker[idx]);
        });
      }
    }
    var page;
    $(document).ready(function() {
      page = new Map();
      page.init();
    });
    function initializeApp(data) {
      lineid = data.context.userId;
      return data.context.userId;
    }
    function init(){
      window.onload = function (e) {
          liff.init(function (data) {
              $.ajax({
                url: 'https://scampus.yunlin.gov.tw/FRONTAPI/Api/IsRegister',
                //url: 'https://localhost:44330/Api/IsRegister',
                contentType: 'application/json',
                type: 'Post',
                data: JSON.stringify({ 
                  LineId: data.context.userId
                }),
                error: function (xhr) {
                    alert('Ajax request 發生錯誤');
                },
                success: function (response) {
                    if(response.code != 1){
                      document.location.href  = "https://scampus.yunlin.gov.tw/yunlin_line/confirm.html";
                    }
                }
            });
          });
      };
    }
  
    init();
  </script>
</html>
